<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:SmartVoiceAgent.Ui.ViewModels"
             x:Class="SmartVoiceAgent.Ui.Views.NeuralOrb"
             x:Name="neuralOrbControl"
             Width="350" Height="350"
             Background="Transparent"
             ClipToBounds="False">

    <UserControl.Styles>
        <!-- Outer ring - subtle border -->
        <Style Selector="Ellipse.OuterRing">
            <Style.Animations>
                <Animation Duration="0:0:4" IterationCount="Infinite" PlaybackDirection="Alternate" Easing="SineEaseInOut">
                    <KeyFrame KeyTime="0:0:0">
                        <Setter Property="ScaleTransform.ScaleX" Value="1.0"/>
                        <Setter Property="ScaleTransform.ScaleY" Value="1.0"/>
                    </KeyFrame>
                    <KeyFrame KeyTime="0:0:4">
                        <Setter Property="ScaleTransform.ScaleX" Value="1.2"/>
                        <Setter Property="ScaleTransform.ScaleY" Value="1.2"/>
                    </KeyFrame>
                </Animation>
            </Style.Animations>
        </Style>

        <!-- Dashed rotating ring -->
        <Style Selector="Ellipse.RotatingRing">
            <Style.Animations>
                <Animation Duration="0:0:10" IterationCount="Infinite">
                    <KeyFrame KeyTime="0:0:0">
                        <Setter Property="RotateTransform.Angle" Value="0"/>
                    </KeyFrame>
                    <KeyFrame KeyTime="0:0:10">
                        <Setter Property="RotateTransform.Angle" Value="360"/>
                    </KeyFrame>
                </Animation>
            </Style.Animations>
        </Style>

        <!-- Core glow pulse -->
        <Style Selector="Ellipse.CoreGlow">
            <Style.Animations>
                <Animation Duration="0:0:4" IterationCount="Infinite" PlaybackDirection="Alternate" Easing="SineEaseInOut">
                    <KeyFrame KeyTime="0:0:0">
                        <Setter Property="Opacity" Value="0.5"/>
                        <Setter Property="ScaleTransform.ScaleX" Value="1.0"/>
                        <Setter Property="ScaleTransform.ScaleY" Value="1.0"/>
                    </KeyFrame>
                    <KeyFrame KeyTime="0:0:4">
                        <Setter Property="Opacity" Value="0.8"/>
                        <Setter Property="ScaleTransform.ScaleX" Value="1.05"/>
                        <Setter Property="ScaleTransform.ScaleY" Value="1.05"/>
                    </KeyFrame>
                </Animation>
            </Style.Animations>
        </Style>

        <!-- Button styles -->
        <Style Selector="ToggleButton#OrbButton">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="Transitions">
                <Transitions>
                    <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.15"/>
                </Transitions>
            </Setter>
        </Style>
        <Style Selector="ToggleButton#OrbButton:pointerover /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="Background" Value="Transparent"/>
        </Style>
        <Style Selector="ToggleButton#OrbButton:pressed">
            <Setter Property="RenderTransform" Value="scale(0.95)"/>
        </Style>
    </UserControl.Styles>

    <Grid Background="Transparent" ClipToBounds="False">

        <!-- Outer border ring -->
        <Ellipse Classes="OuterRing"
                 Stroke="{Binding #neuralOrbControl.OrbColor}"
                 StrokeThickness="1"
                 Width="250" Height="250"
                 Opacity="0.15">
            <Ellipse.RenderTransform>
                <ScaleTransform/>
            </Ellipse.RenderTransform>
        </Ellipse>

        <!-- Dashed rotating ring -->
        <Ellipse Classes="RotatingRing"
                 Stroke="{Binding #neuralOrbControl.OrbColor}"
                 StrokeThickness="1"
                 StrokeDashArray="4,4"
                 Width="200" Height="200"
                 Opacity="0.3">
            <Ellipse.RenderTransform>
                <RotateTransform/>
            </Ellipse.RenderTransform>
        </Ellipse>

        <!-- Core glow (large blur) -->
        <Ellipse Classes="CoreGlow"
                 Fill="{Binding #neuralOrbControl.OrbColor}"
                 Width="160" Height="160">
            <Ellipse.RenderTransform>
                <ScaleTransform/>
            </Ellipse.RenderTransform>
            <Ellipse.Effect>
                <BlurEffect Radius="50"/>
            </Ellipse.Effect>
        </Ellipse>

        <!-- Core center with shadow -->
        <Border Width="96" Height="96"
                CornerRadius="48"
                Background="{DynamicResource CardBgBrush}"
                BorderBrush="{Binding #neuralOrbControl.OrbColor}"
                BorderThickness="1"
                BoxShadow="0 0 40 0 #4006B6D4"/>

        <!-- Center button with brain-circuit icon -->
        <ToggleButton x:Name="OrbButton"
                      HorizontalAlignment="Center"
                      VerticalAlignment="Center"
                      Cursor="Hand">
            <Canvas Width="40" Height="40">
                <!-- Brain paths -->
                <Path Stroke="{Binding #neuralOrbControl.OrbColor}"
                      StrokeThickness="1.5"
                      StrokeLineCap="Round"
                      StrokeJoin="Round"
                      Stretch="Uniform"
                      Width="40" Height="40"
                      Data="M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z M9 13a4.5 4.5 0 0 0 3-4 M6.003 5.125A3 3 0 0 0 6.401 6.5 M3.477 10.896a4 4 0 0 1 .585-.396 M6 18a4 4 0 0 1-1.967-.516 M12 13h4 M12 18h6a2 2 0 0 1 2 2v1 M12 8h8 M16 8V5a2 2 0 0 1 2-2"/>
                <!-- Circuit dots -->
                <Ellipse Canvas.Left="25.2" Canvas.Top="20" Width="2" Height="2" Fill="{Binding #neuralOrbControl.OrbColor}"/>
                <Ellipse Canvas.Left="28.5" Canvas.Top="3" Width="2" Height="2" Fill="{Binding #neuralOrbControl.OrbColor}"/>
                <Ellipse Canvas.Left="31.8" Canvas.Top="33" Width="2" Height="2" Fill="{Binding #neuralOrbControl.OrbColor}"/>
                <Ellipse Canvas.Left="31.8" Canvas.Top="11.7" Width="2" Height="2" Fill="{Binding #neuralOrbControl.OrbColor}"/>
            </Canvas>
        </ToggleButton>
    </Grid>
</UserControl>
