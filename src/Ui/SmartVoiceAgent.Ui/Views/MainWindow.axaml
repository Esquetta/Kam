<Window xmlns="https://github.com/avaloniaui"
		xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
		xmlns:vm="using:SmartVoiceAgent.Ui.ViewModels"
		xmlns:pagevm="using:SmartVoiceAgent.Ui.ViewModels.PageModels"
		xmlns:local="clr-namespace:SmartVoiceAgent.Ui.Views"
		xmlns:services="clr-namespace:SmartVoiceAgent.Ui.Services"
		xmlns:converters="clr-namespace:SmartVoiceAgent.Ui.Converters"
		x:Class="SmartVoiceAgent.Ui.Views.MainWindow"
		x:DataType="vm:MainWindowViewModel"
		Background="{DynamicResource PanelBgBrush}"
		TransparencyLevelHint="Mica"
		ExtendClientAreaToDecorationsHint="True"
		Title="COORDINATOR AI KERNEL"
		Icon="/Assets/favicon.ico"
		Width="1280" Height="800"
		MinWidth="800" MinHeight="600">

	<Window.Resources>
		<!-- Window State Manager Instance -->
		<services:WindowStateManager x:Key="WindowStateManager" />
		
		<!-- Converters -->
		<converters:LogPanelVisibilityConverter x:Key="LogPanelVisibilityConverter" />
		<converters:LogPanelWidthConverter x:Key="LogPanelWidthConverter" />
		<converters:ResponsiveFontSizeConverter x:Key="ResponsiveFontSizeConverter" />
		<converters:ResponsiveScaleConverter x:Key="ResponsiveScaleConverter" />
		<converters:CompactModeConverter x:Key="CompactModeConverter" />
		<converters:MediumModeConverter x:Key="MediumModeConverter" />
		<converters:ExpandedModeConverter x:Key="ExpandedModeConverter" />
	</Window.Resources>

	<Window.Styles>
		<!-- NavBtn Base Style -->
		<Style Selector="Button.NavBtn">
			<Setter Property="Width" Value="40"/>
			<Setter Property="Height" Value="40"/>
			<Setter Property="Margin" Value="0,4"/>
			<Setter Property="HorizontalAlignment" Value="Center"/>
			<Setter Property="Padding" Value="0"/>
			<Setter Property="Background" Value="Transparent"/>
			<Setter Property="BorderThickness" Value="0"/>
			<Setter Property="CornerRadius" Value="8"/>
			<Setter Property="Cursor" Value="Hand"/>
		</Style>

		<Style Selector="Button.NavBtn /template/ ContentPresenter#PART_ContentPresenter">
			<Setter Property="CornerRadius" Value="8"/>
			<Setter Property="Background" Value="Transparent"/>
			<Setter Property="Transitions">
				<Transitions>
					<BrushTransition Property="Background" Duration="0:0:0.2"/>
				</Transitions>
			</Setter>
		</Style>

		<Style Selector="Button.NavBtn:pointerover /template/ ContentPresenter#PART_ContentPresenter">
			<Setter Property="Background" Value="{DynamicResource CardBgHoverBrush}"/>
		</Style>

		<!-- Active button style -->
		<Style Selector="Button.NavBtn.Active /template/ ContentPresenter#PART_ContentPresenter">
			<Setter Property="Background" Value="{DynamicResource CardBgHoverBrush}"/>
		</Style>

		<Style Selector="Button.NavBtn Path">
			<Setter Property="Fill" Value="{DynamicResource TextMutedBrush}"/>
			<Setter Property="Width" Value="20"/>
			<Setter Property="Height" Value="20"/>
			<Setter Property="Stretch" Value="Uniform"/>
			<Setter Property="HorizontalAlignment" Value="Center"/>
			<Setter Property="VerticalAlignment" Value="Center"/>
			<Setter Property="Transitions">
				<Transitions>
					<BrushTransition Property="Fill" Duration="0:0:0.2"/>
				</Transitions>
			</Setter>
		</Style>

		<Style Selector="Button.NavBtn:pointerover Path">
			<Setter Property="Fill" Value="{DynamicResource TextPrimaryBrush}"/>
		</Style>

		<Style Selector="Button.NavBtn.Active Path">
			<Setter Property="Fill" Value="{DynamicResource AccentCyanBrush}"/>
		</Style>

		<!-- Active Indicator -->
		<Style Selector="Border.ActiveIndicator">
			<Setter Property="Width" Value="2"/>
			<Setter Property="Height" Value="12"/>
			<Setter Property="Background" Value="{DynamicResource AccentCyanBrush}"/>
			<Setter Property="CornerRadius" Value="0,1,1,0"/>
			<Setter Property="HorizontalAlignment" Value="Left"/>
			<Setter Property="VerticalAlignment" Value="Center"/>
			<Setter Property="Opacity" Value="0"/>
			<Setter Property="Transitions">
				<Transitions>
					<DoubleTransition Property="Opacity" Duration="0:0:0.2"/>
				</Transitions>
			</Setter>
		</Style>

		<!-- InfoCard Style -->
		<Style Selector="Border.InfoCard">
			<Setter Property="Background" Value="{DynamicResource CardBgBrush}"/>
			<Setter Property="BorderBrush" Value="{DynamicResource BorderSubtleBrush}"/>
			<Setter Property="BorderThickness" Value="1"/>
			<Setter Property="CornerRadius" Value="16"/>
			<Setter Property="Padding" Value="24"/>
			<Setter Property="Transitions">
				<Transitions>
					<BrushTransition Property="BorderBrush" Duration="0:0:0.3"/>
					<BrushTransition Property="Background" Duration="0:0:0.3"/>
				</Transitions>
			</Setter>
		</Style>

		<Style Selector="Border.InfoCard:pointerover">
			<Setter Property="Background" Value="{DynamicResource CardBgHoverBrush}"/>
		</Style>

		<!-- Log Entry Style -->
		<Style Selector="TextBlock.LogEntry">
			<Setter Property="FontSize" Value="11"/>
			<Setter Property="FontFamily" Value="Consolas, Cascadia Code, monospace"/>
			<Setter Property="Foreground" Value="{DynamicResource LogTextBrush}"/>
			<Setter Property="Opacity" Value="0.7"/>
			<Setter Property="Margin" Value="0,2"/>
			<Setter Property="Transitions">
				<Transitions>
					<DoubleTransition Property="Opacity" Duration="0:0:0.2"/>
				</Transitions>
			</Setter>
		</Style>

		<Style Selector="TextBlock.LogEntry:pointerover">
			<Setter Property="Opacity" Value="1"/>
			<Setter Property="Foreground" Value="{DynamicResource LogTextHighlightBrush}"/>
		</Style>

		<!-- Prompt Input Style -->
		<Style Selector="TextBox#PromptInput">
			<Setter Property="Padding" Value="0"/>
			<Setter Property="MinHeight" Value="20"/>
		</Style>

		<Style Selector="TextBox#PromptInput /template/ Border#PART_BorderElement">
			<Setter Property="Background" Value="Transparent"/>
			<Setter Property="BorderThickness" Value="0"/>
		</Style>

		<Style Selector="TextBox#PromptInput:focus /template/ Border#PART_BorderElement">
			<Setter Property="Background" Value="Transparent"/>
			<Setter Property="BorderThickness" Value="0"/>
		</Style>

		<Style Selector="TextBox#PromptInput:pointerover /template/ Border#PART_BorderElement">
			<Setter Property="Background" Value="Transparent"/>
		</Style>
	</Window.Styles>

	<Panel>
		<Grid RowDefinitions="48, *">
			<Grid.ColumnDefinitions>
				<ColumnDefinition Width="64"/>
				<ColumnDefinition Width="*"/>
				<ColumnDefinition Width="{Binding Source={StaticResource WindowStateManager}, Path=IsLogPanelVisible, Converter={StaticResource LogPanelWidthConverter}}"/>
			</Grid.ColumnDefinitions>

			<!-- Header Bar (Draggable) -->
			<Border Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="3"
					Background="{DynamicResource CardBgBrush}"
					BorderBrush="{DynamicResource BorderSubtleBrush}"
					BorderThickness="0,0,0,1"
					PointerPressed="OnHeaderPointerPressed">
				<Grid Margin="24,0">
					<StackPanel Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Left"
								IsHitTestVisible="False">
						<!-- Status Indicator - Green when online, Red when offline -->
						<Ellipse Width="6" Height="6" 
								 Fill="{Binding StatusColor}" 
								 Margin="0,0,8,0">
							<Ellipse.Effect>
								<BlurEffect Radius="3"/>
							</Ellipse.Effect>
						</Ellipse>
						<Ellipse Width="6" Height="6" 
								 Fill="{Binding StatusColor}" 
								 Margin="-6,0,8,0"/>
						<TextBlock Text="{Binding StatusText}"
								   FontSize="11"
								   FontWeight="Medium"
								   Foreground="{Binding StatusColor}"
								   LetterSpacing="1"
								   VerticalAlignment="Center"/>
					</StackPanel>
				</Grid>
			</Border>

			<!-- Left Navbar -->
			<Border Grid.Row="1" Grid.Column="0"
					Background="{DynamicResource CardBgBrush}"
					BorderBrush="{DynamicResource BorderSubtleBrush}"
					BorderThickness="0,0,1,0">
				<Grid RowDefinitions="Auto, *, Auto" Margin="0,24,0,24">

					<!-- Brand/Logo Button -->
					<Button Grid.Row="0"
							Classes="NavBtn"
							Width="40" Height="40"
							Margin="0,0,0,24"
							Command="{Binding NavigateToCoordinatorCommand}"
							ToolTip.Tip="Coordinator AI">
						<Button.Styles>
							<Style Selector="Button#BrandBtn /template/ ContentPresenter#PART_ContentPresenter">
								<Setter Property="Background" Value="{DynamicResource AccentCyanGlowBrush}"/>
								<Setter Property="BorderBrush" Value="{DynamicResource AccentCyanDimBrush}"/>
								<Setter Property="BorderThickness" Value="1"/>
								<Setter Property="CornerRadius" Value="12"/>
							</Style>
						</Button.Styles>
						<Border Background="{DynamicResource AccentCyanGlowBrush}"
								BorderBrush="{DynamicResource AccentCyanDimBrush}"
								BorderThickness="1"
								CornerRadius="12"
								Width="40" Height="40">
							<Path Data="M3,11H11V3H3M3,21H11V13H3M13,21H21V13H13M13,3V11H21V3"
								  Fill="{DynamicResource AccentCyanBrush}"
								  Width="20" Height="20"
								  Stretch="Uniform"
								  HorizontalAlignment="Center"
								  VerticalAlignment="Center"/>
						</Border>
					</Button>

					<!-- Top Navigation -->
					<StackPanel Grid.Row="1" VerticalAlignment="Top" Margin="12,0">
						<!-- Dashboard / Coordinator -->
						<Grid>
							<Border Classes="ActiveIndicator"
									Opacity="{Binding ActiveView, Converter={x:Static ObjectConverters.Equal}, ConverterParameter={x:Static vm:NavView.Coordinator}}"/>
							<Button Classes.NavBtn="True"
									Classes.Active="{Binding ActiveView, Converter={x:Static ObjectConverters.Equal}, ConverterParameter={x:Static vm:NavView.Coordinator}}"
									Command="{Binding NavigateToCoordinatorCommand}"
									ToolTip.Tip="Dashboard">
								<Path Data="M22 12h-4l-3 9L9 3l-3 9H2"/>
							</Button>
						</Grid>

						<!-- Plugins -->
						<Grid>
							<Border Classes="ActiveIndicator"
									Opacity="{Binding ActiveView, Converter={x:Static ObjectConverters.Equal}, ConverterParameter={x:Static vm:NavView.Plugins}}"/>
							<Button Classes.NavBtn="True"
									Classes.Active="{Binding ActiveView, Converter={x:Static ObjectConverters.Equal}, ConverterParameter={x:Static vm:NavView.Plugins}}"
									Command="{Binding NavigateToPluginsCommand}"
									ToolTip.Tip="Plugins">
								<Path Data="M20.5,11H19V7C19,5.89 18.1,5 17,5H13V3.5A2.5,2.5 0 0,0 10.5,1A2.5,2.5 0 0,0 8,3.5V5H4A2,2 0 0,0 2,7V10.8H3.5C5,10.8 6.2,12 6.2,13.5C6.2,15 5,16.2 3.5,16.2H2V20A2,2 0 0,0 4,22H7.8V20.5C7.8,19 9,17.8 10.5,17.8C12,17.8 13.2,19 13.2,20.5V22H17A2,2 0 0,0 19,20V16H20.5A2.5,2.5 0 0,0 23,13.5A2.5,2.5 0 0,0 20.5,11Z"/>
							</Button>
						</Grid>

						<!-- Settings -->
						<Grid>
							<Border Classes="ActiveIndicator"
									Opacity="{Binding ActiveView, Converter={x:Static ObjectConverters.Equal}, ConverterParameter={x:Static vm:NavView.Settings}}"/>
							<Button Classes.NavBtn="True"
									Classes.Active="{Binding ActiveView, Converter={x:Static ObjectConverters.Equal}, ConverterParameter={x:Static vm:NavView.Settings}}"
									Command="{Binding NavigateToSettingsCommand}"
									ToolTip.Tip="Settings">
								<Path Data="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11.03L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.97 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.97 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11.03C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.95C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.68 16.04,18.34 16.56,17.95L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z"/>
							</Button>
						</Grid>
					</StackPanel>

					<!-- Bottom Navigation -->
					<StackPanel Grid.Row="2" Margin="12,0">
						<!-- Theme Toggle -->
						<Button Classes="NavBtn"
								Command="{Binding ToggleThemeCommand}"
								ToolTip.Tip="Toggle Theme">
							<Panel Width="20" Height="20">
								<Path Data="M12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,2L14.39,5.42C13.65,5.15 12.84,5 12,5C11.16,5 10.35,5.15 9.61,5.42L12,2M3.34,7L7.5,6.65C6.9,7.16 6.36,7.78 5.94,8.5C5.5,9.24 5.25,10 5.11,10.79L3.34,7M3.36,17L5.12,13.23C5.26,14 5.53,14.78 5.95,15.5C6.37,16.24 6.91,16.86 7.5,17.37L3.36,17M20.65,7L18.88,10.79C18.74,10 18.47,9.23 18.05,8.5C17.63,7.78 17.1,7.15 16.5,6.64L20.65,7M20.64,17L16.5,17.36C17.09,16.85 17.62,16.22 18.04,15.5C18.46,14.77 18.73,14 18.87,13.21L20.64,17M12,22L9.59,18.56C10.33,18.83 11.14,19 12,19C12.82,19 13.63,18.83 14.37,18.56L12,22Z"
									  Fill="#FACC15"
									  Stretch="Uniform"
									  IsVisible="{Binding IsDarkMode}"/>
								<Path Data="M17.75,4.09L15.22,6.03L16.13,9.09L13.5,7.28L10.87,9.09L11.78,6.03L9.25,4.09L12.44,4L13.5,1L14.56,4L17.75,4.09M21.25,11L19.61,12.25L20.2,14.23L18.5,13.06L16.8,14.23L17.39,12.25L15.75,11L17.81,10.95L18.5,9L19.19,10.95L21.25,11M18.97,15.95C19.8,15.87 20.69,17.05 20.16,17.8C19.84,18.25 19.5,18.67 19.08,19.07C15.17,23 8.84,23 4.94,19.07C1.03,15.17 1.03,8.83 4.94,4.93C5.34,4.53 5.76,4.17 6.21,3.85C6.96,3.32 8.14,4.21 8.06,5.04C7.79,7.9 8.75,10.87 10.95,13.06C13.14,15.26 16.1,16.22 18.97,15.95Z"
									  Fill="#A5B4FC"
									  Stretch="Uniform"
									  IsVisible="{Binding !IsDarkMode}"/>
							</Panel>
						</Button>

						<!-- User Avatar -->
						<Border Width="32" Height="32"
								CornerRadius="16"
								Margin="0,12,0,0"
								HorizontalAlignment="Center">
							<Border.Background>
								<LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
									<GradientStop Color="{DynamicResource BorderMuted}" Offset="0"/>
									<GradientStop Color="{DynamicResource TextMuted}" Offset="1"/>
								</LinearGradientBrush>
							</Border.Background>
						</Border>
					</StackPanel>
				</Grid>
			</Border>

			<!-- Center Content - View Container -->
			<Border Grid.Row="1" Grid.Column="1" ClipToBounds="True">
				<Panel>
					<!-- Ambient Background Effect -->
					<Ellipse Width="600" Height="600"
							 HorizontalAlignment="Center"
							 VerticalAlignment="Center"
							 Fill="{DynamicResource AccentCyanGlowBrush}"
							 Opacity="0.3">
						<Ellipse.Effect>
							<BlurEffect Radius="120"/>
						</Ellipse.Effect>
					</Ellipse>

					<!-- Content -->
					<ContentControl Content="{Binding CurrentViewModel}" Margin="40">
						<ContentControl.DataTemplates>
							<DataTemplate DataType="pagevm:CoordinatorViewModel">
								<local:CoordinatorView/>
							</DataTemplate>

							<DataTemplate DataType="pagevm:PluginsViewModel">
								<local:PluginsView/>
							</DataTemplate>

							<DataTemplate DataType="pagevm:SettingsViewModel">
								<local:SettingsView/>
							</DataTemplate>
						</ContentControl.DataTemplates>
					</ContentControl>
				</Panel>
			</Border>

			<!-- Right Panel - Kernel Log -->
			<Border Grid.Row="1" Grid.Column="2"
					Background="{DynamicResource CardBgBrush}"
					BorderBrush="{DynamicResource BorderSubtleBrush}"
					BorderThickness="1,0,0,0"
					IsVisible="{Binding Source={StaticResource WindowStateManager}, Path=IsLogPanelVisible}">
				<Grid RowDefinitions="48, *, Auto">

					<!-- Window Controls -->
					<Border Grid.Row="0"
							BorderBrush="{DynamicResource BorderSubtleBrush}"
							BorderThickness="0,0,0,1">
						<StackPanel Orientation="Horizontal"
									HorizontalAlignment="Right"
									VerticalAlignment="Center"
									Margin="0,0,16,0"
									Spacing="8">
							<Ellipse Width="12" Height="12" Fill="{DynamicResource BorderMutedBrush}"/>
							<Ellipse Width="12" Height="12" Fill="{DynamicResource BorderMutedBrush}"/>
							<Ellipse Width="12" Height="12" Fill="{DynamicResource AccentErrorGlowBrush}"
								 Stroke="{DynamicResource AccentErrorBrush}"
								 StrokeThickness="0"/>
						</StackPanel>
					</Border>

					<!-- Log Header -->
					<StackPanel Grid.Row="0"
								Orientation="Horizontal"
								HorizontalAlignment="Left"
								VerticalAlignment="Center"
								Margin="24,0">
						<TextBlock Text="KERNEL_LOG"
								   FontSize="11"
								   FontWeight="SemiBold"
								   Foreground="{DynamicResource TextMutedBrush}"
								   LetterSpacing="2"/>
						<Path Data="M22 12h-4l-3 9L9 3l-3 9H2"
							  Fill="{DynamicResource AccentCyanBrush}"
							  Width="12" Height="12"
							  Stretch="Uniform"
							  Margin="12,0,0,0"
							  VerticalAlignment="Center"/>
					</StackPanel>

					<!-- Log Content -->
					<ScrollViewer x:Name="LogScrollViewer" Grid.Row="1"
								  VerticalScrollBarVisibility="Auto"
								  Margin="24,16,24,0">
						<ItemsControl ItemsSource="{Binding LogEntries}">
							<ItemsControl.ItemTemplate>
								<DataTemplate>
									<TextBlock Text="{Binding}" Classes="LogEntry" TextWrapping="Wrap" Margin="0,2"/>
								</DataTemplate>
							</ItemsControl.ItemTemplate>
						</ItemsControl>
					</ScrollViewer>

					<!-- Input Prompt -->
					<Border Grid.Row="2"
							BorderBrush="{DynamicResource BorderSubtleBrush}"
							BorderThickness="0,1,0,0"
							Padding="16,8">
						<Grid ColumnDefinitions="Auto, *">
							<TextBlock Grid.Column="0"
									   Text=">"
									   FontSize="12"
									   FontFamily="Consolas"
									   Foreground="{DynamicResource AccentGreenBrush}"
									   VerticalAlignment="Center"
									   Margin="0,0,8,0"/>
							<TextBox Grid.Column="1"
									 x:Name="PromptInput"
									 Watermark="Enter command..."
									 FontSize="12"
									 FontFamily="Consolas"
									 Background="Transparent"
									 BorderThickness="0"
									 Foreground="{DynamicResource TextSecondaryBrush}"
									 VerticalAlignment="Center"
									 AcceptsReturn="False"
									 TextWrapping="NoWrap"
									 Text="{Binding CommandInputText, Mode=TwoWay}"
									 KeyDown="OnPromptKeyDown"/>
						</Grid>
					</Border>
				</Grid>
			</Border>
		</Grid>
	</Panel>
</Window>
